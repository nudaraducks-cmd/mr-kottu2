<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MR KOTTU | Kitchen Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #000; color: #fff; font-family: monospace; }
        .order-card { border: 1px solid #333; background: #111; transition: all 0.3s; }
        .new-order { border-color: #d4af37; background: #1a1500; animation: flash 1s; }
        @keyframes flash { 0% { background-color: #d4af37; } 100% { background-color: #1a1500; } }
    </style>
</head>
<body class="p-6">
    <header class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4">
        <h1 class="text-3xl font-bold text-[#d4af37]">KITCHEN ORDERS</h1>
        <div class="text-xs text-gray-500" id="status">Connecting...</div>
    </header>

    <div id="orders-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div class="col-span-full text-center text-gray-600 py-20 italic">Waiting for orders...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhR6spBqRutgGCqJ3bD-oDWXXZxiYPf0Q",
            authDomain: "kottu-d5c53.firebaseapp.com",
            databaseURL: "https://kottu-d5c53-default-rtdb.firebaseio.com",
            projectId: "kottu-d5c53",
            storageBucket: "kottu-d5c53.firebasestorage.app",
            messagingSenderId: "899083631592",
            appId: "1:899083631592:web:55ec627979a2d69279c25d",
            measurementId: "G-9K189EXET2"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const appId = 'mr-kottu-ar';

        const container = document.getElementById('orders-container');

        onAuthStateChanged(auth, (user) => {
            if(user) {
                document.getElementById('status').innerText = "LIVE";
                document.getElementById('status').className = "text-green-500 font-bold animate-pulse";
                
                const ordersRef = ref(db, `artifacts/${appId}/public/data/orders`);
                onValue(ordersRef, (snapshot) => {
                    const data = snapshot.val();
                    container.innerHTML = '';
                    
                    if (data) {
                        // Sort by time (newest first)
                        const orders = Object.keys(data).map(key => ({ id: key, ...data[key] })).sort((a,b) => b.timestamp - a.timestamp);
                        
                        orders.forEach(order => {
                            const time = new Date(order.timestamp).toLocaleTimeString();
                            const div = document.createElement('div');
                            div.className = `order-card p-4 rounded-xl relative ${order.status === 'pending' ? 'new-order' : 'opacity-50'}`;
                            
                            div.innerHTML = `
                                <div class="flex justify-between items-start mb-2">
                                    <span class="bg-[#d4af37] text-black px-2 py-1 rounded text-xs font-bold">TABLE ${order.tableNo}</span>
                                    <span class="text-xs text-gray-500">${time}</span>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-1">${order.itemName}</h3>
                                <p class="text-gray-400 text-sm mb-4">QTY: <b class="text-white text-lg">${order.qty}</b></p>
                                
                                ${order.status === 'pending' ? 
                                    `<button onclick="window.completeOrder('${order.id}')" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-2 rounded text-sm transition">MARK DONE</button>` : 
                                    `<div class="text-center text-green-500 font-bold text-xs border border-green-900 py-2 rounded">COMPLETED</div>`
                                }
                            `;
                            container.appendChild(div);
                        });
                    } else {
                        container.innerHTML = `<div class="col-span-full text-center text-gray-600 py-20 italic">No orders yet.</div>`;
                    }
                });
            } else { signInAnonymously(auth); }
        });

        window.completeOrder = (id) => {
            update(ref(db, `artifacts/${appId}/public/data/orders/${id}`), { status: 'completed' });
        };
    </script>
</body>
</html>
