<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'ARISTO AR Menu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-three.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #container { width: 100vw; height: 100vh; }
        #ui-overlay { position: absolute; bottom: 20px; width: 100%; text-align: center; color: white; font-family: 'Times New Roman', serif; z-index: 10; }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="ui-overlay">
        <h2>L'ARISTO</h2>
        <p>Scan the menu to see the magic!</p>
    </div>

    <script>
        const mindarThree = new window.MINDAR.IMAGE.MindARThree({
            container: document.getElementById("container"),
            imageTargetSrc: "./targets.mind", // ඔයා හදාගත්ත mind file එකේ නම
        });

        const {renderer, scene, camera} = mindarThree;
        const loader = new THREE.GLTFLoader();

        // 1. කෑම Models සඳහා Anchors (මෙනු එකේ target 0 සඳහා)
        const anchor = mindarThree.addAnchor(0);
        
        // Risotto Model එක load කිරීම
        loader.load('./assets/risotto.glb', (gltf) => {
            const model = gltf.scene;
            model.scale.set(0.2, 0.2, 0.2);
            model.position.set(0, 0, 0);
            anchor.group.add(model);
        });

        // 2. පියඹන සත්තු එකතු කිරීම (World Space)
        const animals = [];
        const spawnAnimal = () => {
            loader.load('./assets/bird.glb', (gltf) => {
                const bird = gltf.scene;
                bird.scale.set(0.05, 0.05, 0.05);
                bird.position.set((Math.random()-0.5)*4, 1, (Math.random()-0.5)*4);
                scene.add(bird);
                animals.push({
                    mesh: bird,
                    speed: 0.01 + Math.random() * 0.02,
                    phase: Math.random() * Math.PI * 2
                });
            });
        };

        // සත්තු 5ක් එකතු කරන්න
        for(let i=0; i<5; i++) spawnAnimal();

        // Lighting
        const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
        scene.add(light);

        const start = async() => {
            await mindarThree.start();
            renderer.setAnimationLoop(() => {
                // සත්තු පියඹන animation එක
                animals.forEach(a => {
                    a.mesh.position.y += Math.sin(Date.now() * 0.001 + a.phase) * 0.002;
                    a.mesh.position.x += a.speed;
                    if(a.mesh.position.x > 5) a.mesh.position.x = -5;
                });
                renderer.render(scene, camera);
            });
        }
        start();
    </script>
</body>
</html>
